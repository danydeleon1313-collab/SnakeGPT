<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SnakeGPT</title>
<style>
body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: Arial, sans-serif;
    position: relative;
}
canvas { border: 4px solid #0f0; }
#menu {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(0,0,0,0.85);
    padding: 10px;
    border: 2px solid #0f0;
    display: none;
    color: white;
}
#menu div {margin-top:5px;}
button {margin-top:5px;padding:4px 8px;cursor:pointer;}
</style>
</head>
<body>

<canvas id="game" width="400" height="400"></canvas>

<div id="menu">
    <div>Change Snake Color:</div>
    <input type="color" id="snakeColor" value="#00ff00">
    
    <div>Change Fruit:</div>
    <select id="fruitType">
        <option value="apple">Apple</option>
        <option value="cherry">Cherry</option>
        <option value="orange">Orange</option>
        <option value="lime">Lime</option>
        <option value="blueberry">Blueberry</option>
    </select>
    
    <div>Background Preset:</div>
    <select id="bgPreset">
        <option value="gradient1">Dark Gradient</option>
        <option value="gradient2">Purple Gradient</option>
        <option value="gradient3">Night Sky</option>
        <option value="minimalist">Minimalist</option>
    </select>
    
    <div>Gamemode:</div>
    <select id="gameMode">
        <option value="normal">Normal</option>
        <option value="wall">Wall Mode</option>
        <option value="reverse">Reverse Mode</option>
        <option value="badfruit">Bad Fruit Mode</option>
    </select>

    <div>Number of Fruits:</div>
    <select id="fruitCount">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
    </select>
    
    <button id="closeMenu">Resume</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const box = 20;

// Variables
let snake = [{x:9*box,y:9*box}];
let direction="RIGHT";
let foods = [];
let score=0;
let gameOver=false;
let pulse=0;
let snakeColor="#00ff00";
let paused=false;
let fruitType="apple";
let bgPreset="gradient1";
let gameMode="normal";
let walls = [];
let fruitCount = 1; 
let badFruitIndices = []; 

// Menu elements
const menu = document.getElementById("menu");
const snakeColorInput = document.getElementById("snakeColor");
const fruitSelect = document.getElementById("fruitType");
const bgSelect = document.getElementById("bgPreset");
const gameModeSelect = document.getElementById("gameMode");
const fruitCountSelect = document.getElementById("fruitCount");
const closeMenuBtn = document.getElementById("closeMenu");

// Event listeners
document.addEventListener("keydown", e=>{
    if(e.key==="ArrowUp" && direction!=="DOWN") direction="UP";
    if(e.key==="ArrowDown" && direction!=="UP") direction="DOWN";
    if(e.key==="ArrowLeft" && direction!=="RIGHT") direction="LEFT";
    if(e.key==="ArrowRight" && direction!=="LEFT") direction="RIGHT";
    if(e.key==="r" && gameOver) reset();
    if(e.key==="Escape") togglePause();
});

snakeColorInput.addEventListener("input", e=>snakeColor=e.target.value);
fruitSelect.addEventListener("change", e=>fruitType=e.target.value);
bgSelect.addEventListener("change", e=>bgPreset=e.target.value);
gameModeSelect.addEventListener("change", e=>{
    gameMode=e.target.value;
    if(gameMode==="badfruit" && fruitCount===1) fruitCount=2; 
    spawnFruits();
});
fruitCountSelect.addEventListener("change", e=>{
    fruitCount=parseInt(e.target.value);
    if(gameMode==="badfruit" && fruitCount===1) fruitCount=2; 
    spawnFruits();
});
closeMenuBtn.addEventListener("click", togglePause);

function togglePause(){ paused=!paused; menu.style.display=paused?"block":"none"; }

function spawnFruits(){
    foods = [];
    badFruitIndices = [];
    let count = fruitCount;

    if(gameMode==="badfruit" && count===1) count=2;

    for(let i=0;i<count;i++){
        let fx=Math.floor(Math.random()*20)*box;
        let fy=Math.floor(Math.random()*20)*box;
        foods.push({x:fx,y:fy});
    }

    if(gameMode==="badfruit"){
        let badCount = 0;
        if(count===2) badCount = 1;
        else if(count===3) badCount = Math.floor(Math.random()*2)+1;
        else if(count===4) badCount = Math.floor(Math.random()*3)+1;

        while(badFruitIndices.length<badCount){
            let idx = Math.floor(Math.random()*count);
            if(!badFruitIndices.includes(idx)) badFruitIndices.push(idx);
        }
    }
}

// reset game
function reset(){
    snake=[{x:9*box,y:9*box}];
    direction="RIGHT";
    score=0;
    gameOver=false;
    pulse=0;
    walls=[];
    spawnFruits();
}

// Background presets
function drawBackground(){
    if(bgPreset==="gradient1"){
        let gradient=ctx.createLinearGradient(0,0,canvas.width,canvas.height);
        gradient.addColorStop(0,"#0a0a0a"); gradient.addColorStop(1,"#1a1a2e");
        ctx.fillStyle=gradient;
    } else if(bgPreset==="gradient2"){
        let gradient=ctx.createLinearGradient(0,0,canvas.width,canvas.height);
        gradient.addColorStop(0,"#2a0030"); gradient.addColorStop(1,"#800080");
        ctx.fillStyle=gradient;
    } else if(bgPreset==="gradient3"){
        let gradient=ctx.createLinearGradient(0,0,canvas.width,canvas.height);
        gradient.addColorStop(0,"#000022"); gradient.addColorStop(1,"#000055");
        ctx.fillStyle=gradient;
    } else if(bgPreset==="minimalist"){
        ctx.fillStyle="#888888";
    }
    ctx.fillRect(0,0,canvas.width,canvas.height);

    if(bgPreset==="minimalist"){
        ctx.strokeStyle="#00ff00";
        ctx.lineWidth=4;
        ctx.strokeRect(0,0,canvas.width,canvas.height);
    }
}

// Grid overlay
function drawGrid(){
    if(bgPreset!=="minimalist"){
        ctx.strokeStyle='rgba(255,255,255,0.05)';
        for(let i=0;i<=canvas.width;i+=box){ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,canvas.height);ctx.stroke();}
        for(let j=0;j<=canvas.height;j+=box){ctx.beginPath();ctx.moveTo(0,j);ctx.lineTo(canvas.width,j);ctx.stroke();}
    }
}

// Draw walls
function drawWalls(){
    ctx.fillStyle="#555555";
    walls.forEach(w=>ctx.fillRect(w.x,w.y,box,box));
}

// Draw snake with tongue
function drawSnake(){
    snake.forEach((s,i)=>{
        const gradient=ctx.createLinearGradient(s.x,s.y,s.x+box,s.y+box);
        gradient.addColorStop(0,snakeColor);
        gradient.addColorStop(1,darkenColor(snakeColor,0.6));
        ctx.fillStyle=gradient; ctx.fillRect(s.x,s.y,box,box);
        ctx.strokeStyle='#003300'; ctx.strokeRect(s.x,s.y,box,box);

        if(i===0){
            ctx.fillStyle='white';
            ctx.beginPath();ctx.arc(s.x+box*0.3,s.y+box*0.3,2,0,Math.PI*2);ctx.fill();
            ctx.beginPath();ctx.arc(s.x+box*0.7,s.y+box*0.3,2,0,Math.PI*2);ctx.fill();
            // tongue
            ctx.strokeStyle='red'; ctx.beginPath();
            if(direction==="UP"){ctx.moveTo(s.x+box/2,s.y); ctx.lineTo(s.x+box/2,s.y-5);}
            else if(direction==="DOWN"){ctx.moveTo(s.x+box/2,s.y+box); ctx.lineTo(s.x+box/2,s.y+box+5);}
            else if(direction==="LEFT"){ctx.moveTo(s.x,s.y+box/2); ctx.lineTo(s.x-5,s.y+box/2);}
            else{ctx.moveTo(s.x+box,s.y+box/2); ctx.lineTo(s.x+box+5,s.y+box/2);}
            ctx.stroke();
        }
    });
}

// Draw fruits
function drawFruits(){
    pulse+=0.1;
    foods.forEach((food,i)=>{
        let radius=box/2-2+Math.sin(pulse)*2;
        let color1,color2,leafColor='green';
        if(fruitType==='apple'){color1='#ff5555'; color2='#aa1111';}
        else if(fruitType==='cherry'){color1='#ff007f'; color2='#aa0040';}
        else if(fruitType==='orange'){color1='#ff8800'; color2='#cc5500';}
        else if(fruitType==='lime'){color1='#88ff00'; color2='#55aa00'; leafColor='#228B22';}
        else if(fruitType==='blueberry'){color1='#5555ff'; color2='#1111aa'; leafColor='#228B22';}

        if(gameMode==="badfruit" && badFruitIndices.includes(i)){ color1="#000000"; color2="#222222"; leafColor="#550000"; }

        const gradient=ctx.createRadialGradient(food.x+box/2,food.y+box/2,2,food.x+box/2,food.y+box/2,radius);
        gradient.addColorStop(0,color1); gradient.addColorStop(1,color2);
        ctx.fillStyle=gradient; ctx.beginPath(); ctx.arc(food.x+box/2,food.y+box/2,radius,0,Math.PI*2); ctx.fill();

        // leaf
        ctx.fillStyle=leafColor; ctx.beginPath();
        ctx.moveTo(food.x+box/2,food.y+box/2-radius);
        ctx.lineTo(food.x+box/2+5,food.y+box/2-radius-8);
        ctx.lineTo(food.x+box/2-5,food.y+box/2-radius-8);
        ctx.closePath(); ctx.fill();
    });
}

// Score
function drawScore(){ ctx.fillStyle='white'; ctx.font='16px Arial'; ctx.fillText("Score: "+score,10,20); }

function darkenColor(hex,factor){ let r=parseInt(hex.slice(1,3),16)*factor;
let g=parseInt(hex.slice(3,5),16)*factor; let b=parseInt(hex.slice(5,7),16)*factor; return `rgb(${r},${g},${b})`; }

// Update
function update(){
    if(paused||gameOver) return;
    let head={...snake[0]};
    if(direction==="UP") head.y-=box;
    if(direction==="DOWN") head.y+=box;
    if(direction==="LEFT") head.x-=box;
    if(direction==="RIGHT") head.x+=box;

    if(head.x<0||head.y<0||head.x>=canvas.width||head.y>=canvas.height) gameOver=true;
    for(let i=0;i<snake.length;i++) if(head.x===snake[i].x&&head.y===snake[i].y) gameOver=true;
    for(let i=0;i<walls.length;i++) if(head.x===walls[i].x&&head.y===walls[i].y) gameOver=true;

    snake.unshift(head);

    // check all fruits
    for(let i=0;i<foods.length;i++){
        if(head.x===foods[i].x && head.y===foods[i].y){
            score++;
            if(gameMode==="wall") walls.push({x:foods[i].x,y:foods[i].y});
            if(gameMode==="reverse"){ if(direction==="UP") direction="DOWN";
                                       else if(direction==="DOWN") direction="UP";
                                       else if(direction==="LEFT") direction="RIGHT";
                                       else direction="LEFT";}
            if(gameMode==="badfruit" && badFruitIndices.includes(i)) gameOver=true;

            // REPLACE ONLY THE EATEN FRUIT
            let fx=Math.floor(Math.random()*20)*box;
            let fy=Math.floor(Math.random()*20)*box;
            foods[i] = {x: fx, y: fy };

            if(gameMode==="badfruit"){
                badFruitIndices[i] = Math.random()<0.5 ? true : false;
            }

            return;
        }
    }

    if(gameMode!=="badfruit" || foods.length>0) snake.pop();
}

// Draw loop
function draw(){
    drawBackground(); 
    drawGrid(); 
    drawWalls(); 
    drawFruits(); 
    drawSnake(); 
    drawScore();
    update();
    if(gameOver){ 
        ctx.fillStyle='red'; 
        ctx.font='20px Arial'; 
        ctx.fillText("GAME OVER",120,190);
        ctx.font='14px Arial'; 
        ctx.fillText("Press R to Restart",125,215);
    }

    // Draw credit
    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.font = '12px Arial';
    ctx.fillText('- made by ChatGPT', 10, canvas.height - 10);
}

// start game
spawnFruits();
setInterval(function(){ try{ draw(); } catch(e){ console.error("Draw error:",e); } },100);
</script>

</body>
</html>
